{"version":3,"sources":["routes/reward.js"],"names":["Reward","props","context","indendWithdraw","gateway","post","ethAddr","currentUser","then","message","success","redeemReward","get","res","contracts","SGN","methods","cacheSend","data","result","renderActions","type","onClick","accounts","setting","network","drizzle","state","redeemedServiceReward","cacheCall","DPoS","redeemedMiningReward","axios","create","baseURL","timeout","setState","catch","err","console","error","warning","this","miningReward","serviceReward","_","isEmpty","title","actions","style","marginTop","span","value","formatCelrValue","values","React","Component","contextTypes","PropTypes","object","drizzleConnect"],"mappings":"iVASMA,E,kDACJ,WAAYC,EAAOC,GAAU,IAAD,uBAC1B,cAAMD,IAqCRE,eAAiB,WACf,EAAKC,QACFC,KAAK,4BAA6B,CACjCC,QAAS,EAAKC,cAEfC,MAAK,WACJC,IAAQC,QACN,6DA7CoB,EAkD5BC,aAAe,WACb,EAAKP,QACFQ,IADH,mCACmC,EAAKL,cACrCC,MAAK,SAACK,GACL,EAAKC,UAAUC,IAAIC,QAAQL,aAAaM,UACtC,KAAOJ,EAAIK,KAAKC,YAvDI,EA4D5BC,cAAgB,WACd,MAAO,CACL,kBAAC,IAAD,CAAQC,KAAK,UAAUC,QAAS,EAAKnB,gBAArC,qBAGA,kBAAC,IAAD,CAAQkB,KAAK,UAAUC,QAAS,EAAKX,cAArC,mBAjEwB,IAIxBY,EAEEtB,EAFFsB,SACWC,EACTvB,EADFwB,QAAWD,QALa,OAO1B,EAAKjB,YAAcgB,EAAS,GAC5B,EAAKT,UAAYZ,EAAQwB,QAAQZ,UACjC,EAAKa,MAAQ,GAEb,EAAKb,UAAUC,IAAIC,QAAQY,sBAAsBC,UAC/C,EAAKtB,aAEP,EAAKO,UAAUgB,KAAKd,QAAQe,qBAAqBF,UAC/C,EAAKtB,aAGP,EAAKH,QAAU4B,IAAMC,OAAO,CAC1BC,QAASV,EAAQpB,QACjB+B,QAAS,MAGX,EAAK/B,QACFQ,IADH,4BAC4B,EAAKL,cAC9BC,MAAK,SAACK,GACL,EAAKuB,SAAL,eACKvB,EAAIK,KAAKC,YAGfkB,OAAM,SAACC,GACNC,QAAQC,MAAMF,GACd7B,IAAQgC,QACN,wEAjCoB,E,qDAuElB,IAAD,EACeC,KAAKzC,MAAnB6B,EADD,EACCA,KAAMf,EADP,EACOA,IADP,EAEiC2B,KAAKf,MAArCgB,EAFD,EAECA,aAAcC,EAFf,EAEeA,cACdb,EAAyBD,EAAzBC,qBACAH,EAA0Bb,EAA1Ba,sBAER,OAAIiB,IAAEC,QAAQlB,IAA0BiB,IAAEC,QAAQf,GACzC,kBAAC,IAAD,MAIP,kBAAC,IAAD,CAAMgB,MAAM,SAASC,QAASN,KAAKtB,iBACjC,kBAAC,IAAD,CAAK6B,MAAO,CAAEC,UAAW,SACvB,kBAAC,IAAD,CAAKC,KAAM,IACT,kBAAC,IAAD,CACEJ,MAAM,2BACNK,MAAOC,YAAgBV,MAG3B,kBAAC,IAAD,CAAKQ,KAAM,IACT,kBAAC,IAAD,CACEJ,MAAM,4BACNK,MAAOC,YAAgBT,MAG3B,kBAAC,IAAD,CAAKO,KAAM,IACT,kBAAC,IAAD,CACEJ,MAAM,yBACNK,MAAOC,YAAgBR,IAAES,OAAOvB,GAAsB,GAAGqB,UAG7D,kBAAC,IAAD,CAAKD,KAAM,IACT,kBAAC,IAAD,CACEJ,MAAM,0BACNK,MAAOC,YAAgBR,IAAES,OAAO1B,GAAuB,GAAGwB,gB,GA1GnDG,IAAMC,WAuH3BxD,EAAOyD,aAAe,CACpB/B,QAASgC,IAAUC,QAcNC,mCAAe5D,GAX9B,SAAyB2B,GAAQ,IACvBF,EAA4CE,EAA5CF,QAASF,EAAmCI,EAAnCJ,SAAUT,EAAyBa,EAAzBb,UAAWgB,EAAcH,EAAdG,KAAMf,EAAQY,EAARZ,IAE5C,MAAO,CACLU,UACAF,WACAO,KAAK,2BAAMA,GAAShB,EAAUgB,MAC9Bf,IAAI,2BAAMA,GAAQD,EAAUC","file":"static/js/10.a50485a1.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport _ from 'lodash';\nimport { drizzleConnect } from 'drizzle-react';\nimport { Skeleton, Card, Statistic, Row, Col, Button, message } from 'antd';\nimport axios from 'axios';\n\nimport { formatCelrValue } from '../utils/unit';\n\nclass Reward extends React.Component {\n  constructor(props, context) {\n    super(props);\n\n    const {\n      accounts,\n      network: { setting },\n    } = props;\n    this.currentUser = accounts[0];\n    this.contracts = context.drizzle.contracts;\n    this.state = {};\n\n    this.contracts.SGN.methods.redeemedServiceReward.cacheCall(\n      this.currentUser\n    );\n    this.contracts.DPoS.methods.redeemedMiningReward.cacheCall(\n      this.currentUser\n    );\n\n    this.gateway = axios.create({\n      baseURL: setting.gateway,\n      timeout: 1000,\n    });\n\n    this.gateway\n      .get(`/validator/reward/${this.currentUser}`)\n      .then((res) => {\n        this.setState({\n          ...res.data.result,\n        });\n      })\n      .catch((err) => {\n        console.error(err);\n        message.warning(\n          'Please config gateway url in setting to load sgn reward correctly'\n        );\n      });\n  }\n\n  indendWithdraw = () => {\n    this.gateway\n      .post('/validator/withdrawReward', {\n        ethAddr: this.currentUser,\n      })\n      .then(() => {\n        message.success(\n          'Success! Please wait a few seconds to trigger redeem.'\n        );\n      });\n  };\n\n  redeemReward = () => {\n    this.gateway\n      .get(`/validator/rewardRequest/${this.currentUser}`)\n      .then((res) => {\n        this.contracts.SGN.methods.redeemReward.cacheSend(\n          '0x' + res.data.result\n        );\n      });\n  };\n\n  renderActions = () => {\n    return [\n      <Button type=\"primary\" onClick={this.indendWithdraw}>\n        Initialize Redeem\n      </Button>,\n      <Button type=\"primary\" onClick={this.redeemReward}>\n        Redeem Reward\n      </Button>,\n    ];\n  };\n\n  render() {\n    const { DPoS, SGN } = this.props;\n    const { miningReward, serviceReward } = this.state;\n    const { redeemedMiningReward } = DPoS;\n    const { redeemedServiceReward } = SGN;\n\n    if (_.isEmpty(redeemedServiceReward) || _.isEmpty(redeemedMiningReward)) {\n      return <Skeleton />;\n    }\n\n    return (\n      <Card title=\"Reward\" actions={this.renderActions()}>\n        <Row style={{ marginTop: '10px' }}>\n          <Col span={12}>\n            <Statistic\n              title=\"Cumulative Mining Reward\"\n              value={formatCelrValue(miningReward)}\n            />\n          </Col>\n          <Col span={12}>\n            <Statistic\n              title=\"Cumulative Service Reward\"\n              value={formatCelrValue(serviceReward)}\n            />\n          </Col>\n          <Col span={12}>\n            <Statistic\n              title=\"Redeemed Mining Reward\"\n              value={formatCelrValue(_.values(redeemedMiningReward)[0].value)}\n            />\n          </Col>\n          <Col span={12}>\n            <Statistic\n              title=\"Redeemed Service Reward\"\n              value={formatCelrValue(_.values(redeemedServiceReward)[0].value)}\n            />\n          </Col>\n        </Row>\n      </Card>\n    );\n  }\n}\n\nReward.propTypes = {\n  dispatch: PropTypes.func.isRequired,\n};\n\nReward.contextTypes = {\n  drizzle: PropTypes.object,\n};\n\nfunction mapStateToProps(state) {\n  const { network, accounts, contracts, DPoS, SGN } = state;\n\n  return {\n    network,\n    accounts,\n    DPoS: { ...DPoS, ...contracts.DPoS },\n    SGN: { ...SGN, ...contracts.SGN },\n  };\n}\n\nexport default drizzleConnect(Reward, mapStateToProps);\n"],"sourceRoot":""}