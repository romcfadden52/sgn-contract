(this["webpackJsonptruffle-react-redux-dapp"]=this["webpackJsonptruffle-react-redux-dapp"]||[]).push([[7],{852:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"d",(function(){return i}));var n=["Unbonded","Bonded","Unbonding"],r=["ProposalDeposit","GovernVoteTimeout","SlashTimeout","MinValidatorNum","MaxValidatorNum","MinStakeInPool","AdvanceNoticePeriod"],o={Voting:"1",Closed:"2"},i={Yes:1,No:2,Abstain:3}},956:function(e,t,a){"use strict";a.r(t);var n=a(27),r=a(951),o=a(58),i=a(59),c=a(61),l=a(60),s=a(0),d=a.n(s),u=a(1),m=a.n(u),f=a(44),g=a.n(f),h=a(84),v=a(879),b=a.n(v),p=a(123),S=a.n(p),C=a(845),E=a(857),j=a(12),k=a(120),O=a(57),w=a(848),I=a(254),D=a(957),P=a(850),y=a(843),z=a(152),M=a(259),R=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e,n){var r;return Object(o.a)(this,a),(r=t.call(this,e)).onSubmit=function(){var e=r.props,t=e.onClose,a=e.candidateId;r.form.current.validateFields((function(e,n){if(!e){var o=n.value;r.contracts.DPoS.methods.delegate.cacheSend(a,S.a.utils.toWei(o.toString(),"ether")),t()}}))},r.form=d.a.createRef(),r.contracts=n.drizzle.contracts,r}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onClose,r=[{name:"value",field:"number",fieldOptions:Object(n.a)(Object(n.a)({},M.a),{},{placeholder:"The amount of CELR to delegate"}),rules:[{message:"Please enter a value!",required:!0}]}];return d.a.createElement(y.a,{title:"Delegate Stake",visible:t,onOk:this.onSubmit,onCancel:a},d.a.createElement(z.a,{ref:this.form,items:r}))}}]),a}(d.a.Component);R.contextTypes={drizzle:m.a.object};var x=R,W=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e,n){var r;return Object(o.a)(this,a),(r=t.call(this,e)).onSubmit=function(){var e=r.props,t=e.onClose,a=e.candidate,n=a.args[0];r.form.current.validateFields((function(e,o){if(!e){var i=o.value;"0"===a.value.status?r.contracts.DPoS.methods.withdrawFromUnbondedCandidate.cacheSend(n,S.a.utils.toWei(i.toString(),"ether")):r.contracts.DPoS.methods.intendWithdraw.cacheSend(n,S.a.utils.toWei(i.toString(),"ether")),t()}}))},r.form=d.a.createRef(),r.contracts=n.drizzle.contracts,r}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onClose,r=[{name:"value",field:"number",fieldOptions:Object(n.a)(Object(n.a)({},M.a),{},{placeholder:"The amount of CELR to withdraw"}),rules:[{message:"Please enter a value!",required:!0}]}];return d.a.createElement(y.a,{title:"Withdraw Stake",visible:t,onOk:this.onSubmit,onCancel:a},d.a.createElement(z.a,{ref:this.form,items:r}))}}]),a}(d.a.Component);W.contextTypes={drizzle:m.a.object};var V=W,A=a(245),T=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e,n){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleIncreaseCommission=function(){var e=r.props,t=e.onClose,a=e.network,n=e.candidate;r.form.current.validateFields((function(e,o){if(e)console.log(e);else{var i=o.commissionRate,c=o.rateLockEndTime;i*=A.a,c=g.a.toNumber(c)+a.block.number,i>n.value.commissionRate?r.contracts.DPoS.methods.announceIncreaseCommissionRate.cacheSend(i,c):r.contracts.DPoS.methods.nonIncreaseCommissionRate.cacheSend(i,c),t()}}))},r.state={},r.form=d.a.createRef(),r.contracts=n.drizzle.contracts,r}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onClose,n=[M.b,M.d];return d.a.createElement(y.a,{title:"Increase Commission Rate",visible:t,onOk:this.handleIncreaseCommission,onCancel:a},d.a.createElement(z.a,{ref:this.form,items:n}))}}]),a}(d.a.Component);T.contextTypes={drizzle:m.a.object};var N=Object(h.drizzleConnect)(T,(function(e){return{network:e.network}})),B=a(178),G=a(955),_=a(258),F=[{title:"Delegator",dataIndex:"delegator"},{title:"Delegated Stake",dataIndex:"delegatedStake",sorter:function(e,t){return S.a.utils.toBN(e.delegatedStake).cmp(S.a.utils.toBN(t.delegatedStake))},render:function(e){return Object(_.a)(e)}},{title:"Undelegating Stake",dataIndex:"undelegatingStake"}],L=[{title:"Intent Withdraw Amount",dataIndex:"intentAmount"},{title:"Intent Withdraw Block Height",dataIndex:"intentProposedTime"}],U=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).expandedRowRender=function(e){var t=g.a.zip(e.intentAmounts,e.intentProposedTimes).map((function(e){var t=Object(B.a)(e,2),a=t[0],n=t[1];return{intentAmount:Object(_.a)(a),intentProposedTime:n}}));return d.a.createElement(G.a,{columns:L,dataSource:t,pagination:!1})},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.delegators.filter((function(e){return e.value})).sort((function(e,t){return e.args[1]>t.args[1]})).map((function(e){return Object(n.a)(Object(n.a)({},e.value),{},{delegator:e.args[1]})}));return d.a.createElement(G.a,{dataSource:e,columns:F,pagination:!1,expandedRowRender:this.expandedRowRender})}}]),a}(d.a.Component);var q=Object(h.drizzleConnect)(U,(function(e){return{}})),J=a(849),H=a(870),Y=a.n(H),K=[{title:"Delegator",dataIndex:"delegatorAddr"},{title:"Delegated Stake",dataIndex:"delegatedStake",render:function(e){return Object(_.a)(e)}}],Q=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e,n){var r;Object(o.a)(this,a),r=t.call(this,e);var i=e.candidateId,c=e.network.setting;return r.state={},Y.a.get("".concat(c.gateway,"/validator/candidate/").concat(i)).then((function(e){var t=e.data.result;r.setState({commissionRate:t.commission_rate,stakingPool:t.staking_pool})})).catch((function(e){console.error(e),e.response?J.a.error(e.response.data.error):J.a.warning("Please config gateway url in setting to load sidechain info correctly")})),Y.a.get("".concat(c.gateway,"/validator/candidate-delegators/").concat(i)).then((function(e){var t=e.data.result.map((function(e){return{candidateAddr:e.candidate_addr,delegatedStake:e.delegated_stake,delegatorAddr:e.delegator_addr}}));r.setState({delegators:t})})).catch((function(e){console.error(e),e.response?J.a.error(e.response.data.error):J.a.warning("Please config gateway url in setting to load sidechain info correctly")})),r}return Object(i.a)(a,[{key:"render",value:function(){var e=this.state,t=e.commissionRate,a=e.stakingPool,n=e.delegators,r=e.description,o=void 0===r?{}:r;return d.a.createElement(k.a,null,d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Commission Rate",value:"".concat(100*t," %")})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Staking Pool",value:Object(_.a)(a)})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Website",value:o.website||"N/A"})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Contact",value:o.security_contact||"N/A"})),d.a.createElement(O.a,{span:24},d.a.createElement(G.a,{dataSource:n,columns:K,pagination:!1})))}}]),a}(d.a.Component);Q.contextTypes={drizzle:m.a.object};var X=Object(h.drizzleConnect)(Q,(function(e){return{network:e.network}})),Z=[{title:"Delegator",dataIndex:"delegator"},{title:"Amount",dataIndex:"amount"}],$=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.slashes,t=e.sort((function(e,t){return e.validator>t.validator})).map((function(e){return Object(n.a)(Object(n.a)({},e),{},{amount:Object(_.a)(e.amount)})}));return console.log(e),d.a.createElement(G.a,{dataSource:t,columns:Z,pagination:!1})}}]),a}(d.a.Component);var ee=Object(h.drizzleConnect)($,(function(e){return{}})),te=a(852),ae=function(e){Object(c.a)(a,e);var t=Object(l.a)(a);function a(e,n){var i;Object(o.a)(this,a),(i=t.call(this,e)).toggleDelegateModal=function(){i.setState((function(e){return{isDelegateModalVisible:!e.isDelegateModalVisible}}))},i.toggleWithdrawModal=function(){i.setState((function(e){return{isWithdrawModalVisible:!e.isWithdrawModalVisible}}))},i.toggleCommissionModal=function(){i.setState((function(e){return{isCommissionModalVisible:!e.isCommissionModalVisible}}))},i.confirmWithdraw=function(){var e=i.state.candidateId;i.contracts.DPoS.methods.confirmWithdraw.cacheSend(e)},i.confirmIncreaseCommissionRate=function(){i.contracts.DPoS.methods.confirmIncreaseCommissionRate.cacheSend()},i.claimValidator=function(){i.contracts.DPoS.methods.claimValidator.cacheSend()},i.renderAction=function(){var e=i.props.accounts,t=i.state.candidate,a=t.value.status,n=e[0]===t.args[0],r=d.a.createElement(C.a,null,d.a.createElement(C.a.Item,{onClick:i.toggleDelegateModal},"Delegate"),"0"===a?d.a.createElement(C.a.Item,{onClick:i.toggleWithdrawModal},"Withdraw"):[d.a.createElement(C.a.Item,{onClick:i.toggleWithdrawModal},"Initialize Withdraw"),d.a.createElement(C.a.Item,{onClick:i.confirmWithdraw},"Confirm Withdraw")],n&&d.a.createElement(C.a.Item,{onClick:i.toggleCommissionModal},"Announce Increase Commission Rate"),n&&d.a.createElement(C.a.Item,{onClick:i.confirmIncreaseCommissionRate},"Confirm Increase Commission Rate"),n&&d.a.createElement(C.a.Item,{onClick:i.claimValidator},"Claim Validator"));return d.a.createElement(E.a,{overlay:r},d.a.createElement("a",{className:"ant-dropdown-link"},"Actions ",d.a.createElement(j.a,{type:"down"})))},i.renderCandidateDetail=function(){var e=i.props.SGN,t=i.state,a=t.candidate,n=t.delegators,r=t.slashes,o=a.args[0],c=a.value,l=c.minSelfStake,s=c.stakingPool,u=c.status,m=c.commissionRate,f=c.rateLockEndTime,h=g.a.chain(e.sidechainAddrMap).find((function(e){return e.args[0]===o})).get("value","").value(),v=h&&b.a.encode("sgn",b.a.toWords(S.a.utils.hexToBytes(h)));return d.a.createElement(k.a,{style:{marginTop:"10px"}},d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Address",value:o})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Status",value:te.a[u]})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Min Self Stake",value:Object(_.a)(l)})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Staking Pool",value:Object(_.a)(s)})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Commission Rate",value:"".concat(m/A.a," %")})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Rate Lock End Time",value:"".concat(f," block height")})),d.a.createElement(O.a,{span:12},d.a.createElement(w.a,{title:"Sidechain Address",value:v})),d.a.createElement(O.a,{span:24},d.a.createElement(I.a,null,d.a.createElement(I.a.TabPane,{tab:"Delegators",key:"delegators"},d.a.createElement(q,{delegators:n})),d.a.createElement(I.a.TabPane,{tab:"Sidechain",key:"sidechain"},d.a.createElement(X,{candidateId:o})),d.a.createElement(I.a.TabPane,{tab:"Slashes",key:"slashes"},d.a.createElement(ee,{slashes:r})))))},i.contracts=n.drizzle.contracts,i.state={candidate:null,slashes:[],isDelegateModalVisible:!1,isWithdrawModalVisible:!1,isCommissionModalVisible:!1};var c=e.match.params.id;return i.contracts.SGN.methods.sidechainAddrMap.cacheCall(c),i.contracts.DPoS.events.Delegate({fromBlock:0,filter:{candidate:c}},(function(e,t){if(!e){var a=t.returnValues,n=a.delegator,r=a.candidate;i.contracts.DPoS.methods.getDelegatorInfo.cacheCall(r,n)}})),i.contracts.DPoS.events.Slash({fromBlock:0,filter:{validator:c}},(function(e,t){e||i.setState({slashes:[].concat(Object(r.a)(i.state.slashes),[t.returnValues])})})),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this.state,t=e.candidate,a=e.candidateId,n=e.isDelegateModalVisible,r=e.isWithdrawModalVisible,o=e.isCommissionModalVisible;return t?d.a.createElement(P.a,{title:"Candidate",extra:this.renderAction()},this.renderCandidateDetail(),d.a.createElement(x,{candidateId:a,visible:n,onClose:this.toggleDelegateModal}),d.a.createElement(V,{candidate:t,visible:r,onClose:this.toggleWithdrawModal}),d.a.createElement(N,{candidate:t,visible:o,onClose:this.toggleCommissionModal})):d.a.createElement(D.a,null)}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.match,a=e.DPoS,n=void 0===a?{}:a,r=t.params.id,o=g.a.values(n.getCandidateInfo),i=g.a.find(o,(function(e){return e.args[0]===r})),c=g.a.values(n.getDelegatorInfo).filter((function(e){return e.args[0]===r}));return{candidate:i,candidateId:r,delegators:c}}}]),a}(d.a.Component);ae.contextTypes={drizzle:m.a.object};t.default=Object(h.drizzleConnect)(ae,(function(e){var t=e.accounts,a=e.contracts,r=e.DPoS,o=e.SGN;return{accounts:t,DPoS:Object(n.a)(Object(n.a)({},r),a.DPoS),SGN:Object(n.a)(Object(n.a)({},o),a.SGN)}}))}}]);
//# sourceMappingURL=7.86bcd57f.chunk.js.map